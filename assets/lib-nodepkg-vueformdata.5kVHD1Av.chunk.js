import{$t as e,Bt as t,Jt as n,Kt as r,P as i,Vt as a,at as o,it as s,k as c,m as l,nt as u,p as d,q as f,rn as p,rt as m,v as h}from"./vendor-innoai-tech-vuekit.BrF7mdn2.chunk.js";var g=class o extends i{static of(e,t){return new o(e,()=>a(t)?t():t)}inputs$;constructor(e,t){super(),this.typedef=e,this.inputs$=new d(t()??{})}get inputs(){return this.inputs$.value}#e=new Map;field(t){return this.#e.get(e(t)?t:u.create(t))}delete(t){return this.#e.delete(e(t)?t:u.create(t))}*fields(e,t=this.inputs$.value,n=[]){for(let[r,i,a]of e.entries(t,s)){if(r===m.RecordKey||a.type===`never`)continue;let e=[...n,r],t=u.create(e),i=this.#e.get(t);i||(i=new _(this,a,e),this.#e.set(t,i)),yield i}}submit=()=>{let e={},i=!1;for(let[a,o]of this.#e){if(o.blur(),o.state.error){i=!0;continue}let a=o.input,s=o.validate(a);if(s){o.next(e=>{e.error=s}),i=!0;continue}t(a)||(r(a)?n(e,o.path,{...a}):n(e,o.path,a))}i||this.next(e)};reset(){for(let[e,t]of this.#e)t.reset()}setErrors=(e={})=>{for(let[t,n]of Object.entries(e))for(let[e,r]of this.#e)e==t&&r.next(e=>{e.error=n})}},_=class e extends d{static defaultValue=e=>{try{return e.create(void 0)}catch{return}};constructor(t,n,r,i=u.create(r)){super({initial:p(t.inputs$.value,r,e.defaultValue(n))}),this.form$=t,this.typedef=n,this.path=r,this.pointer=i}get input(){return p(this.form$.inputs$.value,this.path,e.defaultValue(this.typedef))}get meta(){return this.typedef.meta}get state(){return this.value}get name(){return this.pointer}#e;get optional(){return this.#e===void 0&&(this.#e=!this.validate(void 0)),this.#e}#t;get input$(){return this.#t===void 0&&(this.#t=l(this.form$.inputs$,c(t=>p(t,this.path,e.defaultValue(this.typedef))),h())),this.#t}focus=()=>{this.next(e=>{e.focus=!0,e.visited=!0})};blur=()=>{this.next(e=>{e.focus=!1,e.touched=!0})};reset=()=>{this.form$.inputs$.next(e=>{n(e,this.path,this.value.initial)}),this.next({initial:this.value.initial})};update=e=>{this.form$.inputs$.next(t=>{n(t,this.path,e)}),this.next(t=>{t.dirty=e!==t.initial,t.error=this.validate(e)??null})};validate(e){let n=this.typedef.type===`array`&&!t(e)?e.filter(e=>!t(e)):e,[r]=this.typedef.validate(n);if(!r)return;let i=r.failures().filter(e=>e.type!==`never`&&e.path.length===0);if(i.length!==0)return i.map(e=>e.value===void 0?`字段不能为空`:e.message)}destroy(){this.form$.delete(this.name)}};const v=o((e,t)=>f({label:t}).modify(e)),y=o((e,t)=>f({hint:t}).modify(e)),b=o((e,t)=>f({inputBy:t}).modify(e));export{g as i,b as n,v as r,y as t};