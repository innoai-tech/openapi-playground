import{J as t,E as e,S as i,d as s,c as r}from"./lib-nodepkg-typedef.JfBGL8NS.chunk.js";import{I as a,r as n}from"./lib-nodepkg-vuekit.BTmhmOud.chunk.js";import{S as l,a as o,b as u}from"./vendor-rxjs.Bd9FJCma.chunk.js";import{b as h,h as f,a as p,i as d,s as c,g as m}from"./vendor-innoai-tech-lodash.BKx3vM3U.chunk.js";class v extends l{constructor(t,e){super(),this.typedef=t,this.inputs$=new a(e()??{})}static of(t,e){return new v(t,()=>h(e)?e():e)}inputs$;get inputs(){return this.inputs$.value}#t=new Map;field(e){return this.#t.get(f(e)?e:t.create(e))}delete(e){return this.#t.delete(f(e)?e:t.create(e))}*fields(s,r=this.inputs$.value,a=[]){for(let[n,l,o]of s.entries(r,e)){if(n===i.RecordKey||"never"===o.type)continue;let e=[...a,n],s=t.create(e),r=this.#t.get(s);r||(r=new y(this,o,e),this.#t.set(s,r)),yield r}}submit=()=>{let t={},e=!1;for(let[i,s]of this.#t){if(s.blur(),s.state.error){e=!0;continue}let i=s.input,r=s.validate(i);if(r){s.next(t=>{t.error=r}),e=!0;continue}p(i)||(d(i)?c(t,s.path,{...i}):c(t,s.path,i))}e||this.next(t)};reset(){for(let[t,e]of this.#t)e.reset()}setErrors=(t={})=>{for(let[e,i]of Object.entries(t))for(let[t,s]of this.#t)t==e&&s.next(t=>{t.error=i})}}class y extends a{constructor(e,i,s,r=t.create(s)){super({initial:m(e.inputs$.value,s,y.defaultValue(i))}),this.form$=e,this.typedef=i,this.path=s,this.pointer=r}static defaultValue=t=>{try{return t.create(void 0)}catch(t){return}};get input(){return m(this.form$.inputs$.value,this.path,y.defaultValue(this.typedef))}get meta(){return this.typedef.meta}get state(){return this.value}get name(){return this.pointer}#e;get optional(){return void 0===this.#e&&(this.#e=!this.validate(void 0)),this.#e}#i;get input$(){return void 0===this.#i&&(this.#i=n(this.form$.inputs$,u(t=>m(t,this.path,y.defaultValue(this.typedef))),o())),this.#i}focus=()=>{this.next(t=>{t.focus=!0,t.visited=!0})};blur=()=>{this.next(t=>{t.focus=!1,t.touched=!0})};reset=()=>{this.form$.inputs$.next(t=>{c(t,this.path,this.value.initial)}),this.next({initial:this.value.initial})};update=t=>{this.form$.inputs$.next(e=>{c(e,this.path,t)}),this.next(e=>{e.dirty=t!==e.initial,e.error=this.validate(t)??null})};validate(t){let e="array"!==this.typedef.type||p(t)?t:t.filter(t=>!p(t)),[i]=this.typedef.validate(e);if(!i)return;let s=i.failures().filter(t=>"never"!==t.type&&0===t.path.length);if(0!==s.length)return s.map(t=>void 0===t.value?"字段不能为空":t.message)}destroy(){this.form$.delete(this.name)}}let $=s((t,e)=>r({label:e}).modify(t)),g=s((t,e)=>r({hint:e}).modify(t)),x=s((t,e)=>r({inputBy:e}).modify(t));export{v as F,g as h,x as i,$ as l};
