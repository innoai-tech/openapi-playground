var t;import{J as e,E as i,S as s,d as r,c as a}from"./lib-nodepkg-typedef.BeCvLH0i.chunk.js";import{I as n,r as l}from"./lib-nodepkg-vuekit.DPpGd8ge.chunk.js";import{S as o,a as h,b as u}from"./vendor-rxjs.5nMifnmB.chunk.js";import{b as f,f as p,a as d,i as c,s as v,g as m}from"./vendor-innoai-tech-lodash.CuH5DnrJ.chunk.js";class y extends o{constructor(t,e){super(),this.typedef=t,this.inputs$=new n(e()??{})}static of(t,e){return new y(t,()=>f(e)?e():e)}inputs$;get inputs(){return this.inputs$.value}#t=new Map;field(t){return this.#t.get(p(t)?t:e.create(t))}delete(t){return this.#t.delete(p(t)?t:e.create(t))}*fields(t){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.inputs$.value,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];for(let[n,l,o]of t.entries(r,i)){if(n===s.RecordKey||"never"===o.type)continue;let t=[...a,n],i=e.create(t),r=this.#t.get(i);r||(r=new $(this,o,t),this.#t.set(i,r)),yield r}}submit=()=>{let t={},e=!1;for(let[i,s]of this.#t){if(s.blur(),s.state.error){e=!0;continue}let i=s.input,r=s.validate(i);if(r){s.next(t=>{t.error=r}),e=!0;continue}d(i)||(c(i)?v(t,s.path,{...i}):v(t,s.path,i))}e||this.next(t)};reset(){for(let[t,e]of this.#t)e.reset()}setErrors=(t=this,function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};for(let[i,s]of Object.entries(e))for(let[e,r]of t.#t)e==i&&r.next(t=>{t.error=s})})}class $ extends n{constructor(t,i,s,r=e.create(s)){super({initial:m(t.inputs$.value,s,$.defaultValue(i))}),this.form$=t,this.typedef=i,this.path=s,this.pointer=r}static defaultValue=t=>{try{return t.create(void 0)}catch(t){return}};get input(){return m(this.form$.inputs$.value,this.path,$.defaultValue(this.typedef))}get meta(){return this.typedef.meta}get state(){return this.value}get name(){return this.pointer}#e;get optional(){return void 0===this.#e&&(this.#e=!this.validate(void 0)),this.#e}#i;get input$(){return void 0===this.#i&&(this.#i=l(this.form$.inputs$,u(t=>m(t,this.path,$.defaultValue(this.typedef))),h())),this.#i}focus=()=>{this.next(t=>{t.focus=!0,t.visited=!0})};blur=()=>{this.next(t=>{t.focus=!1,t.touched=!0})};reset=()=>{this.form$.inputs$.next(t=>{v(t,this.path,this.value.initial)}),this.next({initial:this.value.initial})};update=t=>{this.form$.inputs$.next(e=>{v(e,this.path,t)}),this.next(e=>{e.dirty=t!==e.initial,e.error=this.validate(t)??null})};validate(t){let e="array"!==this.typedef.type||d(t)?t:t.filter(t=>!d(t)),[i]=this.typedef.validate(e);if(!i)return;let s=i.failures().filter(t=>"never"!==t.type&&0===t.path.length);if(0!==s.length)return s.map(t=>void 0===t.value?"字段不能为空":t.message)}destroy(){this.form$.delete(this.name)}}let g=r((t,e)=>a({label:e}).modify(t)),x=r((t,e)=>a({hint:e}).modify(t)),b=r((t,e)=>a({inputBy:e}).modify(t));export{y as F,x as h,b as i,g as l};
