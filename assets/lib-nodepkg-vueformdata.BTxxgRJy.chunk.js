var I=Object.defineProperty;var B=s=>{throw TypeError(s)};var K=(s,i,t)=>i in s?I(s,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[i]=t;var f=(s,i,t)=>K(s,typeof i!="symbol"?i+"":i,t),C=(s,i,t)=>i.has(s)||B("Cannot "+t);var a=(s,i,t)=>(C(s,i,"read from private field"),t?t.call(s):i.get(s)),y=(s,i,t)=>i.has(s)?B("Cannot add the same private member more than once"):i instanceof WeakSet?i.add(s):i.set(s,t),$=(s,i,t,e)=>(C(s,i,"write to private field"),e?e.call(s,t):i.set(s,t),t);import{J as v,E as N,S as R,d as j,c as w}from"./lib-nodepkg-typedef.aImTnp3-.chunk.js";import{I as U,r as k}from"./lib-nodepkg-vuekit.Ccd8t0Q9.chunk.js";import{S as q,a as z,b as A}from"./vendor-rxjs.CtzYnjP_.chunk.js";import{b as G,f as J,a as b,i as H,s as g,g as x}from"./vendor-innoai-tech-lodash.BDvUhzFk.chunk.js";var o;const E=class E extends q{constructor(t,e){super();f(this,"inputs$");y(this,o,new Map);f(this,"submit",()=>{const t={};let e=!1;for(const[u,r]of a(this,o)){if(r.blur(),r.state.error){e=!0;continue}const n=r.input,h=r.validate(n);if(h){r.next(p=>{p.error=h}),e=!0;continue}b(n)||(H(n)?g(t,r.path,{...n}):g(t,r.path,n))}e||this.next(t)});f(this,"setErrors",(t={})=>{for(const[e,u]of Object.entries(t))for(const[r,n]of a(this,o))r==e&&n.next(h=>{h.error=u})});this.typedef=t,this.inputs$=new U(e()??{})}static of(t,e){return new E(t,()=>G(e)?e():e)}get inputs(){return this.inputs$.value}field(t){return a(this,o).get(J(t)?t:v.create(t))}delete(t){return a(this,o).delete(J(t)?t:v.create(t))}*fields(t,e=this.inputs$.value,u=[]){for(const[r,n,h]of t.entries(e,N)){if(r===R.RecordKey||h.type==="never")continue;const p=[...u,r],V=v.create(p);let m=a(this,o).get(V);m||(m=new S(this,h,p),a(this,o).set(V,m)),yield m}}reset(){for(let[t,e]of a(this,o))e.reset()}};o=new WeakMap;let M=E;var c,d;const l=class l extends U{constructor(t,e,u,r=v.create(u)){super({initial:x(t.inputs$.value,u,l.defaultValue(e))});y(this,c);y(this,d);f(this,"focus",()=>{this.next(t=>{t.focus=!0,t.visited=!0})});f(this,"blur",()=>{this.next(t=>{t.focus=!1,t.touched=!0})});f(this,"reset",()=>{this.form$.inputs$.next(t=>{g(t,this.path,this.value.initial)}),this.next({initial:this.value.initial})});f(this,"update",t=>{this.form$.inputs$.next(e=>{g(e,this.path,t)}),this.next(e=>{e.dirty=t!==e.initial,e.error=this.validate(t)??null})});this.form$=t,this.typedef=e,this.path=u,this.pointer=r}get input(){return x(this.form$.inputs$.value,this.path,l.defaultValue(this.typedef))}get meta(){return this.typedef.meta}get state(){return this.value}get name(){return this.pointer}get optional(){return typeof a(this,c)>"u"&&$(this,c,!this.validate(void 0)),a(this,c)}get input$(){return typeof a(this,d)>"u"&&$(this,d,k(this.form$.inputs$,A(t=>x(t,this.path,l.defaultValue(this.typedef))),z())),a(this,d)}validate(t){const e=this.typedef.type==="array"&&!b(t)?t.filter(n=>!b(n)):t,[u]=this.typedef.validate(e);if(!u)return;const r=u.failures().filter(n=>n.type!=="never"&&n.path.length===0);if(r.length!==0)return r.map(n=>n.value===void 0?"字段不能为空":n.message)}destroy(){this.form$.delete(this.name)}};c=new WeakMap,d=new WeakMap,f(l,"defaultValue",t=>{try{return t.create(void 0)}catch{return}});let S=l;const X=j((s,i)=>w({label:i}).modify(s)),Y=j((s,i)=>w({hint:i}).modify(s)),Z=j((s,i)=>w({inputBy:i}).modify(s));export{M as F,Y as h,Z as i,X as l};
